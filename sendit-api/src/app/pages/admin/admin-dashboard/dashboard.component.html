<!-- Main Container -->
<div class="min-h-screen bg-gray-100">
  <app-navbar></app-navbar>

  <!-- Main Content -->
  <div class="flex">
    <!-- Sidebar -->
    <aside class="w-64 bg-white shadow-sm min-h-screen border-r border-gray-200">
      <nav class="p-4 space-y-2">
        <button
          *ngFor="let item of sidebarItems"
          (click)="onSidebarItemClick(item)"
          [class]="item.active ? 'bg-blue-600 text-white' : 'text-gray-700 hover:bg-gray-100'"
          class="w-full text-left px-4 py-2 rounded transition-colors duration-200 flex items-center gap-2">
          <span class="sidebar-icon text-lg">{{ item.icon }}</span>
          <span>{{ item.label }}</span>
        </button>
      </nav>
    </aside>

    <!-- Dynamic Content -->
    <main class="flex-1 p-8">

      <!-- Dashboard View -->
      <ng-container *ngIf="activePage === 'dashboard'">
        <div class="mb-8">
          <h1 class="text-2xl font-semibold text-gray-900 mb-2">Welcome Admin.</h1>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <div class="text-center">
              <h3 class="text-sm font-medium text-gray-500 mb-2">Total Parcels</h3>
              <p class="text-3xl font-bold text-blue-600">{{ totalParcels }}</p>
            </div>
          </div>

          <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <div class="text-center">
              <h3 class="text-sm font-medium text-gray-500 mb-2">Delivered Parcels</h3>
              <p class="text-3xl font-bold text-blue-600">{{ deliveredParcels }}</p>
            </div>
          </div>

          <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <div class="text-center">
              <h3 class="text-sm font-medium text-gray-500 mb-2">Pending Parcels</h3>
              <p class="text-3xl font-bold text-blue-600">{{ pendingParcels }}</p>
            </div>
          </div>

          <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <div class="text-center">
              <h3 class="text-sm font-medium text-gray-500 mb-2">Total Users</h3>
              <p class="text-3xl font-bold text-blue-600">{{ totalUsers }}</p>
            </div>
          </div>
        </div>

        <!-- Pending Parcels Table -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-x-auto mb-8">
          <h2 class="text-xl font-semibold text-gray-900 px-6 pt-6 pb-2">Pending Parcels</h2>
          <!-- Search Bar -->
          <div class="flex flex-wrap gap-4 items-center mb-6 px-6">
            <input
              type="text"
              [(ngModel)]="searchText"
              (ngModelChange)="filterPendingParcels()"
              placeholder="Search by description, address, or weight..."
              class="border border-gray-300 rounded px-3 py-2 text-sm w-64"
            />
            <select
              [(ngModel)]="searchStatus"
              (ngModelChange)="filterPendingParcels()"
              class="border border-gray-300 rounded px-3 py-2 text-sm w-48"
            >
              <option value="">All Statuses</option>
              <option value="Pending">Pending</option>
              <option value="Published">Published</option>
              <option value="Cancelled">Cancelled</option>
              <option value="Completed">Completed</option>
            </select>
          </div>
          <table class="w-full">
            <thead class="bg-gray-50 border-b border-gray-200">
              <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Delivery Address</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Date</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
              </tr>
            </thead>
            <tbody class="bg-white divide-y divide-gray-200">
              <ng-container *ngFor="let parcel of filteredPendingParcels">
                <!-- Main Row -->
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4 text-sm text-blue-600 font-medium">{{ parcel.id }}</td>
                  <td class="px-6 py-4 text-sm">{{ parcel.description }}</td>
                  <td class="px-6 py-4 text-sm">{{ parcel.deliveryAddress }}</td>
                  <td class="px-6 py-4 text-sm">{{ parcel.expectedReceiveDate }}</td>
                  <td class="px-6 py-4">
                    <select
                      class="text-sm rounded px-2 py-1 border border-gray-300"
                      [ngClass]="getStatusClasses(parcel.status)"
                      [ngModel]="parcel.status"
                      (ngModelChange)="updateParcelStatus(parcel.id, $event)"
                    >
                      <option value="Pending">Pending</option>
                      <option value="Published">Published</option>
                      <option value="Cancelled">Cancelled</option>
                      <option value="Completed">Completed</option>
                    </select>
                  </td>
                  <td class="px-6 py-4 text-sm">
                    <button (click)="toggleDetails(parcel)" class="text-blue-600 hover:text-blue-900 font-medium">
                      {{ selectedPendingParcel?.id === parcel.id ? 'Hide Details' : 'View Details' }}
                    </button>
                    <!-- Delete Button -->
                    <button (click)="deleteParcel(parcel.id)" class="ml-3 text-red-600 hover:text-red-900 font-medium">Delete</button>
                  </td>
                </tr>
                <!-- Inline Details Row -->
                <tr *ngIf="selectedPendingParcel?.id === parcel.id">
                  <td colspan="6" class="bg-gray-50 px-6 py-4 text-sm text-gray-700">
                    <div class="parcel-details-section">
                      <form (ngSubmit)="saveParcelEdit(parcel)" class="w-full">
                        <div class="flex justify-end mb-2">
                          <button (click)="closePendingParcelDetails()" type="button" class="text-gray-500 hover:text-red-600 text-xl font-bold">&times;</button>
                        </div>
                        <div class="parcel-details-grid">
                          <div class="parcel-detail-box">
                            <div class="parcel-detail-label">Parcel ID:</div>
                            <div class="parcel-detail-value">{{ parcel.id }}</div>
                          </div>
                          <div class="parcel-detail-box">
                            <div class="parcel-detail-label">Sent On:</div>
                            <div class="parcel-detail-value">
                              <ng-container *ngIf="parcel.status === 'Pending'; else sentOnText">
                                <input [(ngModel)]="parcel.expectedReceiveDate" name="expectedReceiveDate" class="w-full border rounded px-2 py-1 text-sm" />
                              </ng-container>
                              <ng-template #sentOnText>{{ parcel.expectedReceiveDate }}</ng-template>
                            </div>
                          </div>
                          <div class="parcel-detail-box">
                            <div class="parcel-detail-label">Receiver:</div>
                            <div class="parcel-detail-value">
                              <ng-container *ngIf="parcel.status === 'Pending'; else receiverText">
                                <input [(ngModel)]="parcel.receiverName" name="receiverName" class="w-full border rounded px-2 py-1 text-sm" />
                              </ng-container>
                              <ng-template #receiverText>{{ parcel.receiverName }}</ng-template>
                            </div>
                          </div>
                          <div class="parcel-detail-box">
                            <div class="parcel-detail-label">Weight:</div>
                            <div class="parcel-detail-value">
                              <ng-container *ngIf="parcel.status === 'Pending'; else weightText">
                                <input [(ngModel)]="parcel.weight" name="weight" class="w-full border rounded px-2 py-1 text-sm" />
                              </ng-container>
                              <ng-template #weightText>{{ parcel.weight }}</ng-template>
                            </div>
                          </div>
                          <div class="parcel-detail-box">
                            <div class="parcel-detail-label">Destination:</div>
                            <div class="parcel-detail-value">
                              <ng-container *ngIf="parcel.status === 'Pending'; else destText">
                                <input [(ngModel)]="parcel.deliveryAddress" name="deliveryAddress" class="w-full border rounded px-2 py-1 text-sm" />
                              </ng-container>
                              <ng-template #destText>{{ parcel.deliveryAddress }}</ng-template>
                            </div>
                          </div>
                          <div class="parcel-detail-box">
                            <div class="parcel-detail-label">Pickup:</div>
                            <div class="parcel-detail-value">
                              <ng-container *ngIf="parcel.status === 'Pending'; else pickupText">
                                <input [(ngModel)]="parcel.pickupLocation" name="pickupLocation" class="w-full border rounded px-2 py-1 text-sm" />
                              </ng-container>
                              <ng-template #pickupText>{{ parcel.pickupLocation }}</ng-template>
                            </div>
                          </div>
                          <div class="parcel-detail-box">
                            <div class="parcel-detail-label">Status:</div>
                            <div class="parcel-detail-value">
                              <span class="parcel-status-badge">{{ parcel.status || 'Pending' }}</span>
                            </div>
                          </div>
                        </div>
                        <div class="flex justify-between items-center mt-4">
                          <div class="parcel-details-track" (click)="goToTrackOrder(parcel)" style="cursor:pointer;">
                            <span class="parcel-details-track-icon">🗺️</span>
                            <span class="parcel-details-track-text">Track your parcel</span>
                          </div>
                          <button *ngIf="parcel.status === 'Pending'" type="submit" class="bg-blue-600 text-white px-4 py-2 rounded font-semibold hover:bg-blue-700 transition">Save</button>
                        </div>
                      </form>
                    </div>
                  </td>
                </tr>
              </ng-container>
              <tr *ngIf="filteredPendingParcels.length === 0">
                <td colspan="6" class="px-6 py-4 text-center text-gray-400">No pending parcels found.</td>
              </tr>
            </tbody>
          </table>
        </div>

      </ng-container>

      <!-- Create Parcel View -->
      <ng-container *ngIf="activePage === 'create'">
        <app-create-parcel></app-create-parcel>
      </ng-container>

      <!-- Manage Parcels View -->
      <ng-container *ngIf="activePage === 'manage-parcel'">
        <app-manage-parcel></app-manage-parcel>
      </ng-container>

      <!-- Manage Users View -->
      <ng-container *ngIf="activePage === 'users'">
        <app-manage-users></app-manage-users>
      </ng-container>

    </main>
  </div>
</div>